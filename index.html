<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>A Simple Page with CKEditor</title>
        <!-- Make sure the path to CKEditor is correct. -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="node_modules/axe-core/axe.min.js"></script>
        <script src="node_modules/ckeditor-dev/ckeditor.js"></script>
    </head>
    <body>
        <form>
            <textarea name="editor1" id="editor1" rows="10" cols="80">
                This is my textarea to be replaced with CKEditor.
            </textarea>
            <script>
                CKEDITOR.replace( 'editor1' );

                function test() {
                    // Create Doc object for axe-core library.
                    var doc = document.implementation.createHTMLDocument("New Document");
                    var p = doc.createElement("p");
                    p.innerHTML = CKEDITOR.instances.editor1.document.getBody().getHtml();
                    try {
                        doc.body.appendChild(p);
                    } catch(e) {
                        console.log(e);
                    }

                    console.log(doc);
                    
                    // Axe core demo with image-alt.
                    axe.run(doc, {
                        runOnly: {
                            type: "rule",
                            values: [ "image-alt"]
                        }
                    },
                    function(err, results) {
                        console.log('buu');
                        console.log(results); console.log(err);
                            
                        // @todo hande all violations not just first item.
                        if (typeof results.violations !== 'undefined' && results.violations.length > 0) {
                            
                            var title = '<p>' +  results.violations[0].help + '</p>';
                            var content = '<p>' + results.violations[0].description + '</p>';

                            var panel = new CKEDITOR.ui.balloonPanel( CKEDITOR.instances.editor1, {
                                title: title,
                                content: content
                            } );

                            // Balloon panel demo.
                            panel.attach(document.querySelectorAll('#test_image'));
                        }
                    });
                }

            </script>
        </form>

    </body>
</html>